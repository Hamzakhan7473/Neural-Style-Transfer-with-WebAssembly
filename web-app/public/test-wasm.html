<!DOCTYPE html>
<html>
<head>
    <title>WASM Test</title>
</head>
<body>
    <h1>WebAssembly Module Test</h1>
    <div id="output"></div>
    
    <script>
        async function testWasm() {
            const output = document.getElementById('output');
            
            try {
                output.innerHTML += '<p>üîÑ Loading WebAssembly module...</p>';
                
                // Import the WASM module with cache busting
                const timestamp = Date.now();
                const wasmModule = await import(`/wasm/neural_style_transfer_core.js?t=${timestamp}`);
                output.innerHTML += '<p>‚úÖ WebAssembly module imported successfully</p>';
                
                // Initialize WASM
                await wasmModule.default();
                output.innerHTML += '<p>‚úÖ WebAssembly module initialized</p>';
                
                // Check what's available in the module
                output.innerHTML += `<p>üîç Module keys: ${Object.keys(wasmModule).join(', ')}</p>`;
                output.innerHTML += `<p>üîç ModelRegistry type: ${typeof wasmModule.ModelRegistry}</p>`;
                
                // Create ModelRegistry
                const ModelRegistry = wasmModule.ModelRegistry;
                let registry;
                if (typeof ModelRegistry === 'function') {
                    registry = new ModelRegistry();
                    output.innerHTML += '<p>‚úÖ ModelRegistry created</p>';
                } else {
                    output.innerHTML += `<p>‚ùå ModelRegistry is not a constructor, it's: ${typeof ModelRegistry}</p>`;
                    return;
                }
                
                // Initialize registry
                registry.initialize();
                output.innerHTML += '<p>‚úÖ ModelRegistry initialized</p>';
                
                // Get available styles
                const styles = registry.get_available_styles();
                output.innerHTML += `<p>‚úÖ Available styles: ${JSON.stringify(styles)}</p>`;
                output.innerHTML += `<p>‚úÖ Number of styles: ${styles ? styles.length : 'undefined'}</p>`;
                
                // Test loading a model
                if (styles && styles.length > 0) {
                    const testStyle = styles[0];
                    output.innerHTML += `<p>üîÑ Testing model load: ${testStyle}</p>`;
                    
                    try {
                        registry.load_model(testStyle);
                        output.innerHTML += `<p>‚úÖ Model '${testStyle}' loaded successfully</p>`;
                    } catch (e) {
                        output.innerHTML += `<p>‚ùå Model load failed: ${e.message}</p>`;
                    }
                } else {
                    output.innerHTML += '<p>‚ùå No styles available for testing</p>';
                }
                
                output.innerHTML += '<p>üéâ All tests completed!</p>';
                
            } catch (error) {
                output.innerHTML += `<p>‚ùå Error: ${error.message}</p>`;
                console.error('WASM Test Error:', error);
            }
        }
        
        // Run test when page loads
        testWasm();
    </script>
</body>
</html>
